@page
@model MobileStore.Web.Pages.IndexModel
@{
    ViewData["Title"] = "Trang chủ";
}

<!-- Banner chính -->
<div class="container mt-4">
    <!-- Banner chính dạng carousel -->
    <div class="row mb-3">
        <div class="col-12">
            <div id="bannerCarousel" class="carousel slide shadow rounded overflow-hidden" data-bs-ride="carousel">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="~/banner_main.png" class="d-block w-100" alt="Banner 1">
                    </div>
                    <div class="carousel-item">
                        <img src="~/banner_main2.png" class="d-block w-100" alt="Banner 2">
                    </div>
                    <div class="carousel-item">
                        <img src="~/banner_main3.png" class="d-block w-100" alt="Banner 3">
                    </div>
                    <div class="carousel-item">
                        <img src="~/banner_main4.png" class="d-block w-100" alt="Banner 4">
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#bannerCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon"></span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#bannerCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon"></span>
                </button>
            </div>
        </div>
    </div>

    <!-- Thương hiệu nổi bật -->
    <div class="container mt-5 mb-5">
        <h2 class="fw-bold mb-4">🔝 Thương hiệu nổi bật</h2>
        <div class="row text-center">
            <div class="col"><img src="~/logo_iphone.png" alt="Apple" style="height: 120px;" /></div>
            <div class="col"><img src="~/logo_samsung.png" alt="Samsung" style="height: 90px;" /></div>
            <div class="col"><img src="~/logo_oppo.png" alt="OPPO" style="height: 100px;" /></div>
            <div class="col"><img src="~/logo_xiaomi.jpg" alt="Xiaomi" style="height: 100px;" /></div>
            <div class="col"><img src="~/logo_vivo.png" alt="Vivo" style="height: 100px;" /></div>
        </div>
    </div>

    <!-- Hai banner phụ -->
    <div class="row mt-5">
        <div class="col-md-6 mb-3">
            <img src="~/banner-side.jpg" class="img-fluid rounded shadow w-100" alt="Khuyến mãi 1" />
        </div>
        <div class="col-md-6 mb-3">
            <img src="~/banner-side2.jpg" class="img-fluid rounded shadow w-100" alt="Khuyến mãi 2" />
        </div>
    </div>

    <!-- Sản phẩm nổi bật -->
    <div class="container mt-5">
        <h2 class="fw-bold mb-4">🔥 Sản phẩm nổi bật</h2>
        <div class="swiper mySwiper">
            <div class="swiper-wrapper">
                @foreach (var sp in Model.SanPhamNoiBat)
                {
                    <div class="swiper-slide">
                        <div class="card shadow-sm h-100" style="width: 250px;">
                            <img src="@sp.HinhAnh"
                                 class="card-img-top"
                                 style="height: 220px; object-fit: contain;"
                                 alt="@sp.TenSanPham"
                                 data-product-id="@sp.MaChiTiet"
                                 onerror="this.src='/default-image.jpg'; console.error(`Failed to load image for product ${this.dataset.productId}: ${this.src}`);" />
                            <div class="card-body">
                                <h6 class="card-title">@sp.TenSanPham</h6>
                                <p class="text-danger fw-bold">@sp.Gia.ToString("N0") ₫</p>
                                <a href="/SanPham/ThongTin/@sp.MaChiTiet" class="btn btn-outline-primary btn-sm">Xem chi tiết</a>
                            </div>
                        </div>
                    </div>
                }
            </div>
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
        </div>
    </div>

    <!-- Khuyến mãi -->
    <div class="container mt-5 mb-5">
        <h2 class="fw-bold mb-4 text-center text-primary" style="text-shadow: 1px 1px 2px #0d6efd;">🎉 Khuyến mãi hấp dẫn</h2>
        <div class="row g-4 justify-content-center">
            @foreach (var km in Model.KhuyenMais.Take(2))
            {
                <div class="col-md-6">
                    <div class="card border-0 shadow-lg h-100 rounded-4 overflow-hidden" style="transition: transform 0.3s ease;">
                        <div class="card-header bg-primary text-white text-center fw-semibold fs-5">
                            🎁 Mã khuyến mãi: @km.MaKhuyenMai
                        </div>
                        <div class="card-body d-flex flex-column">
                            <p class="mb-2">
                                <i class="bi bi-calendar-event-fill me-2"></i><strong>Thời gian:</strong>
                                <span class="text-secondary">
                                    @km.NgayBatDau.ToString("dd/MM/yyyy") - @km.NgayKetThuc.ToString("dd/MM/yyyy")
                                </span>
                            </p>
                            <p class="flex-grow-1 text-muted fst-italic" style="font-size: 1.05rem;">
                                "@km.NoiDung"
                            </p>
                            <div class="mb-3 text-center">
                                <span class="countdown fs-5 fw-bold text-danger" data-enddate="@km.NgayKetThuc.ToString("yyyy-MM-ddTHH:mm:ss")"></span>
                            </div>
                            <div class="mt-3 text-end">
                                <span class="badge rounded-pill fs-6" id="status-@km.MaKhuyenMai"></span>
                            </div>
                        </div>
                        <div class="card-footer text-center bg-light">
                            <a href="/KhuyenMai/ChiTiet?id=@km.MaKhuyenMai" class="btn btn-outline-primary btn-sm fw-semibold">
                                Xem chi tiết
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<style>
    .swiper {
        width: 100%;
        padding-bottom: 30px;
    }

    .swiper-slide {
        display: flex;
        justify-content: center;
    }

    #bannerCarousel .carousel-item img {
        height: 400px;
        object-fit: cover;
    }

    .card:hover {
        transform: translateY(-8px);
        box-shadow: 0 10px 25px rgb(13 110 253 / 0.4);
    }
</style>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const swiper = new Swiper('.mySwiper', {
                slidesPerView: 4,
                spaceBetween: 20,
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                autoplay: {
                    delay: 3000,
                    disableOnInteraction: false,
                },
                breakpoints: {
                    0: { slidesPerView: 1 },
                    576: { slidesPerView: 2 },
                    768: { slidesPerView: 3 },
                    992: { slidesPerView: 4 }
                }
            });

            const banner = document.getElementById('bannerCarousel');
            const carousel = new bootstrap.Carousel(banner, {
                interval: 3000,
                ride: 'carousel',
                pause: false
            });

            // Countdown logic
            function initializeCountdowns() {
                const countdownElements = document.querySelectorAll('.countdown');
                countdownElements.forEach(el => {
                    const endDateStr = el.getAttribute('data-enddate');
                    const endDate = new Date(endDateStr);

                    function updateCountdown() {
                        const now = new Date();
                        const diff = endDate - now;

                        if (diff <= 0) {
                            el.innerHTML = '⏰ Đã hết hạn';
                            const status = document.getElementById('status-' + el.closest('.card').querySelector('.card-header').textContent.replace('🎁 Mã khuyến mãi: ', '').trim());
                            if (status) {
                                status.className = 'badge rounded-pill bg-danger fs-6';
                                status.innerHTML = '<i class="fas fa-times-circle me-1"></i> Hết hiệu lực';
                            }
                            clearInterval(intervalId);
                            return;
                        }

                        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
                        const minutes = Math.floor((diff / (1000 * 60)) % 60);
                        const seconds = Math.floor((diff / 1000) % 60);

                        el.innerHTML = `<i class="fas fa-hourglass-half me-1"></i> Còn lại: ${days} ngày ${hours} giờ ${minutes} phút ${seconds} giây`;
                    }

                    updateCountdown();
                    const intervalId = setInterval(updateCountdown, 1000);
                });
            }

            initializeCountdowns();
        });
    </script>
}